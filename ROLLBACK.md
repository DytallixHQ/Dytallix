Rollback Runbook â€” Validator Key Rotation

Scope
- Reverse an unintended validator key rotation, restoring service using the prior key while preserving auditability.

Prerequisites
- Access to Vault or sealed keystore where the previous key is stored.
- Change record for the rotation (who/when/why) and the validator ID.

Paths
- Vault mode: HashiCorp Vault KV v2 at `/<mount>/data/<base>/<VALIDATOR_ID>`
- Keystore mode: `~/.dytallix/keystore/validator-<VALIDATOR_ID>.seal`

Steps
1) Halt signing dependent processes
- Put validator/node in safe mode or stop the producer on the affected node(s).

2) Restore the previous key
- If using Vault:
  - Identify the previous key version. Use `vault kv metadata get <mount>/<base>/<VALIDATOR_ID>` or `vault kv get -versions` if enabled.
  - Promote or write the previous value back as the current secret:
    - Option A (versioned rollback): `vault kv rollback <mount>/<base>/<VALIDATOR_ID> -version <N>` (if available)
    - Option B (explicit): `vault kv put <mount>/<base>/<VALIDATOR_ID> private_key=$(base64 -w0 oldkey.bin)`
- If using sealed keystore:
  - Restore the prior `validator-<VALIDATOR_ID>.seal` from backup.
  - Ensure the correct `DYT_KEYSTORE_PASSPHRASE` is available to decrypt.

3) Restart node(s)
- Restart the node(s) so they reload the restored key into memory.
- Confirm startup log message shows the correct secrets mode (Vault or Sealed Keystore) and that the validator key is loaded.

4) Validate
- Verify signatures/attestations generated by the validator reflect the previous key.
- Monitor for errors or mismatched signatures.

5) Post-rollback
- Open an incident report with cause analysis.
- Rehearse the rotation again in a test environment before re-attempting in production.

Notes
- Never commit or upload plaintext private keys to the repository or artifacts.
- In Vault mode, avoid copying secrets out; prefer versioned rollback where possible.
